â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ğŸš€ GUIDE DE DÃ‰PLOIEMENT CLOUD RUN - Ã‰TAPE PAR Ã‰TAPE             â•‘
â•‘                   David Irie Photographie                                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TEMPS ESTIMÃ‰: 2-3 heures (premiÃ¨re fois)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
PHASE 1: SETUP GOOGLE CLOUD (30 minutes)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ã‰TAPE 1.1: CrÃ©er un compte Google Cloud
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Va sur https://console.cloud.google.com
2. Connecte-toi avec ton compte Google
3. Accepte les termes et conditions
4. Active la facturation:
   - Clique sur "Billing" dans le menu
   - "Add billing account"
   - Entre ta carte bancaire (AUCUN DÃ‰BIT automatique!)
   - Free tier: $300 crÃ©dits gratuits pendant 90 jours
   - AprÃ¨s: Pay-as-you-go (mais on reste dans le free tier!)

Ã‰TAPE 1.2: CrÃ©er un nouveau projet
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. En haut de la console, clique sur le sÃ©lecteur de projet
2. "New Project"
3. Nom: "david-irie-photographie"
4. ID du projet: "david-irie-photographie" (ou auto-gÃ©nÃ©rÃ©)
5. "Create"
6. SÃ©lectionne ce projet

Ã‰TAPE 1.3: Activer les APIs nÃ©cessaires
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Dans la console GCP:
1. Va dans "APIs & Services" > "Library"
2. Active ces APIs (cherche et clique "Enable" sur chacune):
   âœ… Cloud Run API
   âœ… Cloud Build API
   âœ… Container Registry API
   âœ… Cloud Functions API
   âœ… Cloud Logging API
   âœ… Cloud Scheduler API (pour cleanOldGalleries)

Ã‰TAPE 1.4: Installer gcloud CLI
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MacOS:
```bash
brew install google-cloud-sdk
```

Linux:
```bash
curl https://sdk.cloud.google.com | bash
exec -l $SHELL
```

Windows:
TÃ©lÃ©charge l'installeur: https://cloud.google.com/sdk/docs/install

Ã‰TAPE 1.5: Authentifier gcloud
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```bash
# Login
gcloud auth login

# Configure le projet
gcloud config set project david-irie-photographie

# VÃ©rifie la config
gcloud config list
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
PHASE 2: DÃ‰PLOIEMENT INITIAL (1 heure)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ã‰TAPE 2.1: Build Docker image localement (optionnel - test)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```bash
cd david-irie-photographie

# Build l'image
docker build -t david-irie-photographie .

# Test localement
docker run -p 8080:8080 david-irie-photographie

# Ouvre http://localhost:8080 dans ton navigateur
# Si Ã§a marche â†’ CTRL+C pour arrÃªter
```

Ã‰TAPE 2.2: DÃ©ployer sur Cloud Run (PREMIÃˆRE MÃ‰THODE - Manuel)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```bash
# Se placer dans le dossier du projet
cd david-irie-photographie

# DÃ©ployer directement (Cloud Build s'occupe de tout!)
gcloud run deploy david-irie-photographie \
  --source . \
  --platform managed \
  --region europe-west1 \
  --allow-unauthenticated \
  --min-instances 0 \
  --max-instances 10

# Attends 3-5 minutes...
# Tu verras: "Building and deploying... â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%"
# Ã€ la fin, il affiche l'URL: https://david-irie-photographie-xxxxx-ew.a.run.app
```

âœ… TESTE TON SITE: Ouvre l'URL dans un navigateur!

Ã‰TAPE 2.3: DÃ©ployer les Cloud Functions
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

A. sendEmail Function
```bash
cd david-irie-photographie

gcloud functions deploy sendEmail \
  --gen2 \
  --runtime nodejs22 \
  --trigger-http \
  --allow-unauthenticated \
  --region europe-west1 \
  --entry-point sendEmail \
  --source cloud-functions/sendEmail \
  --set-env-vars GMAIL_USER=TON-EMAIL@gmail.com,GMAIL_APP_PASSWORD=xxxx-xxxx-xxxx-xxxx

# Note l'URL retournÃ©e: https://europe-west1-PROJECT_ID.cloudfunctions.net/sendEmail
```

B. uploadToCloudinary Function
```bash
gcloud functions deploy uploadToCloudinary \
  --gen2 \
  --runtime nodejs22 \
  --trigger-http \
  --allow-unauthenticated \
  --region europe-west1 \
  --entry-point uploadToCloudinary \
  --source cloud-functions/uploadToCloudinary \
  --set-env-vars CLOUDINARY_CLOUD_NAME=xxx,CLOUDINARY_API_KEY=xxx,CLOUDINARY_API_SECRET=xxx
```

C. uploadToBackblaze Function
```bash
gcloud functions deploy uploadToBackblaze \
  --gen2 \
  --runtime nodejs22 \
  --trigger-http \
  --allow-unauthenticated \
  --region europe-west1 \
  --entry-point uploadToBackblaze \
  --source cloud-functions/uploadToBackblaze \
  --set-env-vars B2_KEY_ID=xxx,B2_APPLICATION_KEY=xxx,B2_BUCKET_NAME=david-irie-galeries-privees,B2_ENDPOINT=s3.us-west-004.backblazeb2.com,B2_REGION=us-west-004
```

Ã‰TAPE 2.4: Mettre Ã  jour les URLs des fonctions dans le code
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Ã‰dite src/pages/Contact.jsx:

Remplace:
```javascript
const response = await fetch('/.netlify/functions/sendEmail', {
```

Par:
```javascript
const response = await fetch('https://europe-west1-PROJECT_ID.cloudfunctions.net/sendEmail', {
```

(Fais de mÃªme pour uploadToCloudinary et uploadToBackblaze)

Commit et redÃ©ploie:
```bash
git add .
git commit -m "Update function URLs for Cloud Functions"
git push origin main

# RedÃ©ploie Cloud Run
gcloud run deploy david-irie-photographie --source .
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
PHASE 3: CI/CD AUTO-DEPLOY (30 minutes)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ã‰TAPE 3.1: Connecter GitHub Ã  Cloud Build
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Va dans Cloud Console â†’ Cloud Build â†’ Triggers
2. "Connect Repository"
3. SÃ©lectionne "GitHub"
4. Autorise Google Cloud Ã  accÃ©der Ã  ton GitHub
5. SÃ©lectionne "remaestro/david-irie-photographie"
6. "Connect"

Ã‰TAPE 3.2: CrÃ©er un trigger
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. "Create Trigger"
2. Nom: "deploy-on-push"
3. Event: "Push to a branch"
4. Source: Branch = "^main$"
5. Configuration: "Cloud Build configuration file (yaml or json)"
6. Location: "Repository" â†’ /cloudbuild.yaml
7. "Create"

âœ… MAINTENANT: Chaque git push sur main = auto-deploy! ğŸ‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
PHASE 4: OPTIMISATIONS (30 minutes)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ã‰TAPE 4.1: Setup Cloudflare CDN (Ã‰CONOMIE BANDWIDTH!)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. CrÃ©e un compte Cloudflare: https://cloudflare.com
2. Ajoute ton domaine (ou utilise un sous-domaine)
3. Dans Cloudflare DNS:
   - Type: CNAME
   - Name: photos (ou @)
   - Target: ghs.googlehosted.com
4. Dans Cloud Run:
   ```bash
   gcloud run services update david-irie-photographie \
     --region europe-west1 \
     --add-cloudsql-instances photos.tondomaine.com
   ```
5. Dans Cloudflare â†’ SSL/TLS â†’ Overview â†’ "Full"
6. Dans Cloudflare â†’ Speed â†’ Optimization â†’ Enable tout

âœ… RÃ‰SULTAT: Bandwidth GRATUIT illimitÃ©! ğŸ‰

Ã‰TAPE 4.2: Configurer un custom domain
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```bash
gcloud run domain-mappings create \
  --service david-irie-photographie \
  --domain photos.tondomaine.com \
  --region europe-west1
```

Suis les instructions pour configurer le DNS.

Ã‰TAPE 4.3: Setup Monitoring & Alertes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Cloud Console â†’ Monitoring â†’ Alerting
2. "Create Policy"
3. Alerte si:
   - Requests > 1.8M/mois (90% du free tier)
   - Bandwidth > 900 MB (90% du free tier)
4. Notification par email

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
COMMANDES UTILES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# Voir les logs
gcloud run services logs read david-irie-photographie --region europe-west1

# Voir les dÃ©ploiements
gcloud run services list --region europe-west1

# Voir les dÃ©tails du service
gcloud run services describe david-irie-photographie --region europe-west1

# Mettre Ã  jour les variables d'environnement
gcloud run services update david-irie-photographie \
  --region europe-west1 \
  --set-env-vars KEY=VALUE

# Rollback vers une version prÃ©cÃ©dente
gcloud run services update-traffic david-irie-photographie \
  --region europe-west1 \
  --to-revisions REVISION_NAME=100

# Supprimer le service
gcloud run services delete david-irie-photographie --region europe-west1

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
COÃ›TS ESTIMÃ‰S
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Avec ton trafic actuel (50 deploys/mois, 10 clients/mois):

Cloud Run:             0â‚¬ (dans free tier)
Cloud Functions:       0â‚¬ (dans free tier)
Cloud Build:           0â‚¬ (120 builds/jour gratuit)
Bandwidth sans CDN:    ~2â‚¬/mois
Bandwidth avec CDN:    0â‚¬ (Cloudflare gratuit)

TOTAL: 0â‚¬/mois avec Cloudflare! ğŸ‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TROUBLESHOOTING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ProblÃ¨me: "Permission denied"
Solution: 
```bash
gcloud auth application-default login
```

ProblÃ¨me: "Build failed"
Solution: VÃ©rifie les logs
```bash
gcloud builds log --region=europe-west1
```

ProblÃ¨me: "503 Service Unavailable"
Solution: Cold start en cours, rÃ©essaye dans 30s

ProblÃ¨me: Site vide/erreur 404
Solution: VÃ©rifie que base: '/' dans vite.config.js

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‰ FÃ‰LICITATIONS! Ton site est maintenant sur Cloud Run!

Avantages:
âœ… Builds illimitÃ©s (3600/mois gratuit!)
âœ… Deploy illimitÃ©
âœ… 0â‚¬/mois avec Cloudflare CDN
âœ… ScalabilitÃ© infinie
âœ… Pas de vendor lock-in (Docker standard)

